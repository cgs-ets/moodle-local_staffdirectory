{"version":3,"sources":["../src/directory.js"],"names":["define","$","Log","Directory","rootel","self","dir","find","first","prototype","main","keytimer","on","e","clearTimeout","autocomplete","which","search","setTimeout","searchel","hasresults","val","show","query","addClass","removeClass","hide","code","filter","reg","RegExp","test","text","parent","name","campus","dept","job","closest","length","init","debug","error","directory"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Provides the local_staffdirectory/directory module\r\n *\r\n * @package   local_staffdirectory\r\n * @category  output\r\n * @copyright 2020 Michael Vangelovski <michael.vangelovski@hotmail.com>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module local_staffdirectory/directory\r\n */\r\ndefine(['jquery', 'core/log', 'core/ajax'], \r\n    function($, Log, Ajax) {    \r\n    'use strict';\r\n\r\n    /**\r\n     * Initializes the directory component.\r\n     */\r\n    function init() {\r\n        Log.debug('local_staffdirectory/directory: initializing');\r\n\r\n        var rootel = $('#local_staffdirectory-root');\r\n\r\n        if (!rootel.length) {\r\n            Log.error('local_staffdirectory/directory: \\'#local_staffdirectory-root\\' not found!');\r\n            return;\r\n        }\r\n\r\n        var directory = new Directory(rootel);\r\n        directory.main();\r\n    }\r\n\r\n    /**\r\n     * The constructor\r\n     *\r\n     * @constructor\r\n     * @param {jQuery} rootel\r\n     */\r\n    function Directory(rootel) {\r\n        var self = this;\r\n        self.rootel = rootel;\r\n        self.dir = self.rootel.find('.directory-list').first();\r\n\r\n    }\r\n\r\n    /**\r\n     * Run the directory js.\r\n     *\r\n     */\r\n    Directory.prototype.main = function () {\r\n        var self = this;\r\n\r\n        /*var options = {\r\n            valueNames: [ \r\n                'attr_staffcode', \r\n                'attr_displayname',\r\n                'attr_department', \r\n                'attr_jobposition'\r\n            ],\r\n            listClass: \"directory-list\",\r\n            searchClass: \"directory-search\",\r\n        };\r\n\r\n        var directory = new List('local_staffdirectory-root', options);\r\n        directory.on('searchComplete', function(e) {\r\n            self.rootel.removeClass('noitems');\r\n            if (!directory.visibleItems.length) {\r\n                self.rootel.addClass('noitems');\r\n            }\r\n        });*/\r\n\r\n\r\n        // Handle search.\r\n        var keytimer;\r\n        self.rootel.on('keyup', '.directory-search', function(e) {\r\n            clearTimeout(keytimer);\r\n            var autocomplete = $(this);\r\n            if (e.which == 13) {\r\n                self.search(autocomplete);\r\n            } else {\r\n                keytimer = setTimeout(function () {\r\n                    self.search(autocomplete);\r\n                }, 500);\r\n            }\r\n        });\r\n\r\n\r\n    };\r\n\r\n\r\n    /**\r\n     * Search.\r\n     *\r\n     * @method\r\n     */\r\n    Directory.prototype.search = function (searchel) {\r\n        var self = this;\r\n        self.hasresults = false;\r\n\r\n        if (searchel.val() == '') {\r\n            self.dir.find('.dir-row').show();\r\n            return;\r\n        }\r\n\r\n        var query = searchel.val();\r\n\r\n        // Hide values initially\r\n        self.rootel.addClass('searching');\r\n        self.rootel.removeClass('noitems');\r\n        self.dir.find('.dir-row').hide();\r\n\r\n        // Search staff code.\r\n        var code = self.dir.find('.attr_staffcode').filter(function() { \r\n            var reg = new RegExp(query, \"i\");\r\n            return reg.test($(this).text());\r\n        }).parent();\r\n\r\n        // Search name.\r\n        var name = self.dir.find('.attr_displayname').filter(function() { \r\n            var reg = new RegExp(query, \"i\");\r\n            return reg.test($(this).text());\r\n        }).parent();\r\n\r\n        // Search campus.\r\n        var campus = self.dir.find('.attr_campus').filter(function() { \r\n            var reg = new RegExp(query, \"i\");\r\n            return reg.test($(this).text());\r\n        }).parent();\r\n\r\n        // Search departments.\r\n        var dept = self.dir.find('.attr_department').filter(function() { \r\n            var reg = new RegExp(query, \"i\");\r\n            return reg.test($(this).text());\r\n        }).parent();\r\n\r\n        // Search job positions.\r\n        var job = self.dir.find('.attr_jobposition').filter(function() { \r\n            var reg = new RegExp(query, \"i\");\r\n            return reg.test($(this).text());\r\n        }).closest('.dir-row');\r\n\r\n        // Display the rows found.\r\n        code.show();\r\n        name.show();\r\n        campus.show();\r\n        dept.show();\r\n        job.show();\r\n\r\n        self.rootel.removeClass('searching');\r\n\r\n        if (!(code.length + name.length + campus.length + dept.length + job.length)) {\r\n            self.rootel.addClass('noitems');\r\n        }\r\n\r\n    };\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"file":"directory.min.js"}